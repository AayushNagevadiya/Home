<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<div id="esp32Status"></div>

<script type="module">
  // Firebase imports...
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAht7TWN8NlbICl0VbEIuc19Mri7oPlXvc",
    authDomain: "home-automation-89830.firebaseapp.com",
    databaseURL: "https://home-automation-89830-default-rtdb.firebaseio.com",
    projectId: "home-automation-89830"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ✅ FIX: Attach to window
  window.login = function () {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;

    if (user === "12345" && pass === "Aayush@1111") {
      checkESP32Status();
      setInterval(checkESP32Status, 5000);
    } else {
      alert("❌ Wrong credentials!");
    }
  };

  function checkESP32Status() {
    const statusRef = ref(db, "/status/lastSeen");
    onValue(statusRef, (snapshot) => {
      const lastSeen = snapshot.val();
      const now = Date.now();
      const diff = now - lastSeen;

      const statusDiv = document.getElementById("esp32Status");
      if (lastSeen && diff < 10000) {
        statusDiv.textContent = "✅ ESP32 is ONLINE";
        statusDiv.style.color = "green";
      } else {
        statusDiv.textContent = "❌ ESP32 is OFFLINE";
        statusDiv.style.color = "red";
      }
    });
  }
</script>
